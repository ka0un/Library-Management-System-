Index: admin/return.php
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?php\r\n\r\ninclude(__DIR__ . '/../auth/session.php');\r\nrequire_once __DIR__ . '/../config.php';\r\nrequire_once __DIR__ . '/../auth/permission.php';\r\nrequire_once __DIR__ . '/../components/header.php';\r\n\r\nif (!has_permission($_SESSION['uuid'], 'CHECKOUT')) {\r\n    header(\"Location: /index.php\");\r\n}\r\n?>\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Admin Panel</title>\r\n    <link rel=\"stylesheet\" href=\"style/book.php\">\r\n\r\n</head>\r\n\r\n\r\n<style>\r\n    .panel{\r\n        background-color: <?php echo TERTIARY_COLOR; ?>;\r\n        color: <?php echo PRIMARY_COLOR; ?>;\r\n        display: flex;\r\n        flex-direction: row;\r\n        align-items: center;\r\n        justify-content: center;\r\n        margin-top: 10px;\r\n        margin-left: 10px;\r\n        border-radius: 10px;\r\n        height: 85%;\r\n        font-family:Verdana, sans-serif;\r\n        font-weight: bold;\r\n        font-size: 14px;\r\n    }\r\n\r\n    .part{\r\n        display: flex;\r\n        flex-direction: column;\r\n        justify-content: space-between;\r\n        margin-top: 10px;\r\n        margin-left: 5px;\r\n        margin-right: 5px;\r\n        margin-bottom: 10px;\r\n        border-radius: 10px;\r\n        height: 95%;\r\n        width: 30%;\r\n        font-family:Verdana, sans-serif;\r\n        font-weight: bold;\r\n        font-size: 14px;\r\n\r\n    }\r\n\r\n    .input{\r\n        background-color: <?php echo PRIMARY_COLOR; ?>;\r\n        color: <?php echo SECONDARY_COLOR; ?>;\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: center;\r\n        justify-content: center;\r\n        margin-top: 10px;\r\n        margin-left: 10px;\r\n        margin-right: 10px;\r\n        border-radius: 10px;\r\n        height: 50%;\r\n        font-family:Verdana, sans-serif;\r\n        font-weight: bold;\r\n        font-size: 14px;\r\n    }\r\n\r\n    .output {\r\n        background-color: <?php echo SECONDARY_COLOR; ?>;\r\n        color: <?php echo PRIMARY_COLOR; ?>;\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: center;\r\n        justify-content: center;\r\n        margin-top: 10px;\r\n        margin-left: 10px;\r\n        margin-right: 10px;\r\n        border-radius: 10px;\r\n        height: 100%;\r\n        font-family: Verdana, sans-serif;\r\n        font-weight: bold;\r\n        font-size: 14px;\r\n    }\r\n\r\n</style>\r\n\r\n<body bgcolor=\"<?php echo SECONDARY_COLOR;?>\">\r\n\r\n<?php\r\ngenerate_header(array());\r\n?>\r\n\r\n<?php\r\ninclude( __DIR__ . '/../components/sidebar.php');\r\n?>\r\n\r\n<div class=\"panel\">\r\n    <div class=\"part\">\r\n        <div class=\"input\">\r\n\r\n            <h1>Enter User ID</h1>\r\n            <form action=\"\" method=\"post\">\r\n                <input type=\"text\" name=\"userid\" id=\"userid\" required autocapitalize=\"characters\" >\r\n                <br><br>\r\n                <input type=\"submit\" value=\"Submit\">\r\n            </form>\r\n\r\n\r\n        </div>\r\n        <div class=\"output\">\r\n\r\n        </div>\r\n    </div>\r\n    <div class=\"part\">\r\n        <div class=\"input\">\r\n\r\n            <h1>Enter Copy ID</h1>\r\n            <form action=\"\" method=\"post\">\r\n                <input type=\"text\" name=\"copyid\" id=\"copyid\" required autocapitalize=\"characters\" >\r\n                <br><br>\r\n                <input type=\"submit\" value=\"Submit\">\r\n            </form>\r\n\r\n\r\n        </div>\r\n        <div class=\"output\">\r\n\r\n        </div>\r\n    </div>\r\n    <div class=\"part\">\r\n        <div class=\"output\">\r\n\r\n        </div>\r\n    </div>\r\n</div>
===================================================================
diff --git a/admin/return.php b/admin/return.php
--- a/admin/return.php	
+++ b/admin/return.php	
@@ -109,6 +109,7 @@
                 <input type="text" name="userid" id="userid" required autocapitalize="characters" >
                 <br><br>
                 <input type="submit" value="Submit">
+
             </form>
 
 
@@ -138,4 +139,7 @@
 
         </div>
     </div>
-</div>
\ No newline at end of file
+</div>
+
+
+/*add_return_report($copyid, $uuid)*/
\ No newline at end of file
Index: admin/checkout.php
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?php\r\n\r\ninclude(__DIR__ . '/../auth/session.php');\r\nrequire_once __DIR__ . '/../config.php';\r\nrequire_once __DIR__ . '/../auth/permission.php';\r\nrequire_once __DIR__ . '/../components/header.php';\r\nrequire_once __DIR__ . '/../sql/checkouts.php';\r\nrequire_once __DIR__ . '/../sql/copies.php';\r\nrequire_once __DIR__ . '/../sql/users.php';\r\nrequire_once __DIR__ . '/../validators/checkout.php';\r\n\r\n\r\nif (!has_permission($_SESSION['uuid'], 'CHECKOUT')) {\r\n    header(\"Location: /index.php\");\r\n}\r\n\r\n\r\n?>\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Admin Panel</title>\r\n    <link rel=\"stylesheet\" href=\"style/book.php\">\r\n\r\n</head>\r\n\r\n\r\n<style>\r\n    .panel{\r\n        background-color: <?php echo TERTIARY_COLOR; ?>;\r\n        color: <?php echo PRIMARY_COLOR; ?>;\r\n        display: flex;\r\n        flex-direction: row;\r\n        align-items: center;\r\n        justify-content: center;\r\n        margin-top: 10px;\r\n        margin-left: 10px;\r\n        border-radius: 10px;\r\n        height: 85%;\r\n        font-family:Verdana, sans-serif;\r\n        font-weight: bold;\r\n        font-size: 14px;\r\n    }\r\n\r\n    .part{\r\n        display: flex;\r\n        flex-direction: column;\r\n        justify-content: space-between;\r\n        margin-top: 10px;\r\n        margin-left: 5px;\r\n        margin-right: 5px;\r\n        margin-bottom: 10px;\r\n        border-radius: 10px;\r\n        height: 95%;\r\n        width: 30%;\r\n        font-family:Verdana, sans-serif;\r\n        font-weight: bold;\r\n        font-size: 14px;\r\n\r\n    }\r\n\r\n    .input{\r\n        background-color: <?php echo PRIMARY_COLOR; ?>;\r\n        color: <?php echo SECONDARY_COLOR; ?>;\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: center;\r\n        justify-content: center;\r\n        margin-top: 10px;\r\n        margin-left: 10px;\r\n        margin-right: 10px;\r\n        border-radius: 10px;\r\n        height: 50%;\r\n        font-family:Verdana, sans-serif;\r\n        font-weight: bold;\r\n        font-size: 14px;\r\n    }\r\n\r\n    .output1 {\r\n        background-color: <?php echo SECONDARY_COLOR; ?>;\r\n        color: <?php echo PRIMARY_COLOR; ?>;\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: center;\r\n        justify-content: center;\r\n        margin-top: 10px;\r\n        margin-left: 10px;\r\n        margin-right: 10px;\r\n        border-radius: 10px;\r\n        height: 100%;\r\n        font-family: Verdana, sans-serif;\r\n        font-weight: bold;\r\n        font-size: 14px;\r\n    }\r\n\r\n    .output2 {\r\n        background-color: <?php echo SECONDARY_COLOR; ?>;\r\n        color: <?php echo PRIMARY_COLOR; ?>;\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: center;\r\n        justify-content: center;\r\n        margin-top: 10px;\r\n        margin-left: 10px;\r\n        margin-right: 10px;\r\n        border-radius: 10px;\r\n        height: 100%;\r\n        font-family: Verdana, sans-serif;\r\n        font-weight: bold;\r\n        font-size: 14px;\r\n    }\r\n\r\n    .output3 {\r\n        background-color: <?php echo SECONDARY_COLOR; ?>;\r\n        color: <?php echo PRIMARY_COLOR; ?>;\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: center;\r\n        justify-content: center;\r\n        margin-top: 10px;\r\n        margin-left: 10px;\r\n        margin-right: 10px;\r\n        border-radius: 10px;\r\n        height: 100%;\r\n        font-family: Verdana, sans-serif;\r\n        font-weight: bold;\r\n        font-size: 14px;\r\n    }\r\n\r\n</style>\r\n\r\n<body bgcolor=\"<?php echo SECONDARY_COLOR;?>\">\r\n\r\n<?php\r\ngenerate_header(array());\r\n?>\r\n\r\n<?php\r\ninclude( __DIR__ . '/../components/sidebar.php');\r\n\r\n?>\r\n\r\n\r\n\r\n<div class=\"panel\">\r\n    <div class=\"part\">\r\n        <div class=\"input\">\r\n\r\n            <h1>Enter User ID</h1>\r\n            <form action=\"\" method=\"post\">\r\n                <?php\r\n                if (isset($_GET['userid'])){\r\n                    echo '<input type=\"text\" name=\"userid\" id=\"userid\" required autocapitalize=\"characters\" value=\"'.$_GET['userid'].'\">';\r\n                }else{\r\n                    echo '<input type=\"text\" name=\"userid\" id=\"userid\" required autocapitalize=\"characters\" >';\r\n                    echo '<script>document.getElementById(\"userid\").focus();</script>';\r\n                }\r\n                ?>\r\n                <br><br>\r\n                <input type=\"submit\" value=\"Submit\">\r\n            </form>\r\n\r\n\r\n        </div>\r\n        <div class=\"output1\">\r\n\r\n            <?php\r\n\r\n            //user id form\r\n            if(isset($_POST['userid'])){\r\n                //redirect user to current page with user id parameter\r\n                echo '<script>window.location.href = \"/admin/checkout.php?userid='.$_POST['userid'].'\";</script>';\r\n            }\r\n\r\n            if (isset($_GET['userid'])){\r\n                display_checkout_user($_GET['userid']);\r\n            }\r\n\r\n            ?>\r\n\r\n        </div>\r\n    </div>\r\n    <div class=\"part\">\r\n        <div class=\"input\">\r\n\r\n            <?php\r\n\r\n            if (isset($_GET['userid'])){\r\n                echo '<h1>Enter Copy ID</h1>';\r\n                echo '<form action=\"\" method=\"post\">';\r\n                if (isset($_GET['copyid'])){\r\n                    echo '<input type=\"text\" name=\"copyid\" id=\"copyid\" required autocapitalize=\"characters\" value=\"'.$_GET['copyid'].'\">';\r\n                }else{\r\n                    echo '<input type=\"text\" name=\"copyid\" id=\"copyid\" required autocapitalize=\"characters\" >';\r\n                }\r\n                echo '<br><br>';\r\n                echo '<input type=\"submit\" value=\"Submit\">';\r\n                echo '</form>';\r\n\r\n                //js for focus cursor to copy id input\r\n                echo '<script>document.getElementById(\"copyid\").focus();</script>';\r\n            }\r\n\r\n            ?>\r\n\r\n        </div>\r\n        <div class=\"output2\">\r\n\r\n            <?php\r\n\r\n            //copy id form\r\n            if(isset($_POST['copyid'])){\r\n                //redirect user to current page with copy id and user id parameter\r\n                echo '<script>window.location.href = \"/admin/checkout.php?userid='.$_GET['userid'].'&copyid='.$_POST['copyid'].'\";</script>';\r\n            }\r\n\r\n            if (isset($_GET['copyid'])){\r\n                display_checkout_copy($_GET['copyid']);\r\n            }\r\n\r\n            ?>\r\n\r\n        </div>\r\n    </div>\r\n    <div class=\"part\">\r\n        <div class=\"output3\">\r\n\r\n            <?php\r\n            if (isset($_GET['userid']) && isset($_GET['copyid'])){\r\n                display_checkout($_GET['userid'], $_GET['copyid']);\r\n            }\r\n            ?>\r\n\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<?php\r\nfunction display_checkout_user($userid)\r\n{\r\n    if(!is_uuid_exists($userid)){\r\n        echo 'Enter a valid user id';\r\n        echo '<style> .output1 { background-color: #ffa7bf; } </style>';\r\n        return;\r\n    }\r\n\r\n    echo '<img src=\"'. get_user_profile_picture_url($userid, 60).'\" width=\"100px\" height=\"100px\">';\r\n    echo '<br>';\r\n    echo '<h3>'.get_user_name($userid).'<h3>';\r\n    echo '<br>';\r\n\r\n    if (has_user_exceeded_checkout_limit($userid)){\r\n        echo 'User has exceeded checkout limit';\r\n        echo '<style> .output1 { background-color: #ffa7bf; } </style>';\r\n    } else {\r\n        echo 'User is eligible to checkout';\r\n        echo '<style> .output1 { background-color: #aaffa7; } </style>';\r\n    }\r\n}\r\n\r\n\r\nfunction display_checkout_copy($copyid)\r\n{\r\n    if(!is_copyid_exists($copyid)){\r\n        echo 'Enter a valid copy id';\r\n        echo '<style> .output2 { background-color: #ffa7bf; } </style>';\r\n        return;\r\n    }\r\n\r\n    echo '<img src=\"'. get_book_image(get_copy_bookid($copyid)).'\" width=\"100px\" height=\"100px\">';\r\n    echo '<br>';\r\n    echo '<h3>'.get_book_title(get_copy_bookid($copyid)).'<h3>';\r\n    echo '<br>';\r\n    echo 'Condition : '.get_copy_pcondition($copyid);\r\n    echo '<br>';\r\n\r\n\r\n    if (is_copy_alredy_checked_out($copyid)){\r\n        echo 'Copy is already checked out';\r\n        echo '<style> .output2 { background-color: #ffa7bf; } </style>';\r\n        return;\r\n    }\r\n\r\n    if (is_copy_pr($copyid)){\r\n        echo 'Copy is permanently reserved';\r\n        echo '<style> .output2 { background-color: #ffa7bf; } </style>';\r\n        return;\r\n    }\r\n\r\n\r\n}\r\n\r\nfunction display_checkout($userid, $copyid)\r\n{\r\n    if (!can_user_checkout_copy($userid, $copyid)){\r\n        echo get_reason_why_user_cannot_checkout_copy($userid, $copyid);\r\n        echo '<style> .output3 { background-color: #ffa7bf; } </style>';\r\n        return;\r\n    }else{\r\n        echo '<style> .output2 { background-color: #aaffa7; } </style>';\r\n        echo '<style> .output3 { background-color: #aaffa7; } </style>';\r\n    }\r\n\r\n    echo '<form action=\"\" method=\"post\" id=\"checkout\">';\r\n    echo '<input type=\"submit\" value=\"Checkout\" name=\"checkout\">';\r\n    echo '</form>';\r\n\r\n    //handle button click\r\n    if (isset($_POST['checkout'])){\r\n\r\n        add_checkout($copyid, $userid);\r\n\r\n        //if copy is reserved, invalidate reservation\r\n        if (is_user_reserved_book($userid, get_copy_bookid($copyid))){\r\n            invalidate_reservation(get_reservation_id($userid, get_copy_bookid($copyid)));\r\n        }\r\n\r\n        //redirect user to current page without parameters\r\n        echo '<script>window.location.href = \"/admin/checkout.php\";</script>';\r\n\r\n\r\n        echo 'Copy checked out';\r\n    }\r\n\r\n\r\n\r\n}\r\n\r\n?>\r\n\r\n<!--js that auto submit the form once x amount of characters enters to the form-->\r\n<script>\r\n    document.getElementById('userid').addEventListener('input', function (e) {\r\n        if (e.target.value.length === 8) {\r\n            e.target.form.submit();\r\n        }\r\n    });\r\n\r\n    document.getElementById('copyid').addEventListener('input', function (e) {\r\n        if (e.target.value.length === 8) {\r\n            e.target.form.submit();\r\n        }\r\n    });\r\n</script>\r\n
===================================================================
diff --git a/admin/checkout.php b/admin/checkout.php
--- a/admin/checkout.php	
+++ b/admin/checkout.php	
@@ -311,6 +311,7 @@
     if (isset($_POST['checkout'])){
 
         add_checkout($copyid, $userid);
+        add_checkout_report($copyid, $userid);
 
         //if copy is reserved, invalidate reservation
         if (is_user_reserved_book($userid, get_copy_bookid($copyid))){
