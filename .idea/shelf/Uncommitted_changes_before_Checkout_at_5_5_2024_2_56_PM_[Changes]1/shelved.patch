Index: book.php
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?php\r\nrequire_once __DIR__ . '/components/header.php';\r\nrequire_once __DIR__ . '/config.php';\r\nrequire_once __DIR__ . '/sql/books.php';\r\nrequire_once __DIR__ . '/sql/copies.php';\r\nrequire_once __DIR__ . '/sql/reservations.php';\r\nrequire_once __DIR__ . '/validators/checkout.php';\r\nrequire_once __DIR__ . '/validators/reservation.php';\r\nrequire_once __DIR__ . '/sql/checkouts.php';\r\nrequire_once __DIR__ . '/sql/categories.php';\r\nrequire_once __DIR__ . '/schedules/sheduler.php';\r\n?>\r\n\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Book Page</title>\r\n    <link rel=\"stylesheet\" href=\"style/book.php\">\r\n</head>\r\n<body bgcolor=\"<?php echo SECONDARY_COLOR;?>\">\r\n<?php\r\n\r\n$bookid = 'B0000001';\r\n\r\nif(isset($_GET['id'])) {\r\n    $id = $_GET['id'];\r\n    $bookid = $id;\r\n}\r\n\r\n$book_title = get_book_title($bookid);\r\n\r\ngenerate_header([\r\n    ['url' => '/books.php', 'text' => 'Books'],\r\n    ['url' => '#', 'text' => $book_title]\r\n]);\r\n\r\n\r\n?>\r\n    <div class=\"book-container\">\r\n        <div class=\"book-image\">\r\n            <img src=\"<?php echo get_book_image($bookid); ?>\" alt=\"Book Cover\">\r\n        </div>\r\n        <div class=\"book-info\">\r\n            <div class=\"book-details\">\r\n                <div class=\"book-category\">\r\n                    <span>Category:</span>\r\n                    <span><?php echo get_categroy_name(get_book_category_id($bookid)); ?></span>\r\n                </div>\r\n                <div class=\"book-title\">\r\n                    <h1><?php echo get_book_title($bookid); ?></h1>\r\n                </div>\r\n                <div class=\"book-author\">\r\n                    <span>By:</span>\r\n                    <span><?php echo get_book_author($bookid); ?></span>\r\n                </div>\r\n                <div class=\"book-description\">\r\n                    <p><?php echo get_book_description($bookid); ?></p>\r\n                </div>\r\n            </div>\r\n            <div class=\"book-actions\">\r\n\r\n                <?php\r\n                // if the user is not logged in, show a message to login\r\n                if(!isset($_SESSION['uuid'])) {\r\n\r\n                    echo '<div class=\"description\">\r\n                    <span>Login to reserve this book!</span>\r\n                </div>';\r\n\r\n                }else {\r\n\r\n                    //check if user has checkout one of the copies\r\n                    $copyids = get_array_of_copyids($bookid);\r\n                    $is_user_checked_out = false;\r\n                    $checkouted_copyid = '';\r\n\r\n                    foreach ($copyids as $copyid) {\r\n                        if (is_user_checked_out_copy($_SESSION['uuid'], $copyid)) {\r\n                            $is_user_checked_out = true;\r\n                            $checkouted_copyid = $copyid;\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    //if user has checked out one of the copies\r\n\r\n                    if ($is_user_checked_out) {\r\n\r\n                        $checkout_id = get_checkout_id($_SESSION['uuid'], $checkouted_copyid);\r\n                        $checkout_copy_id = get_checkout_copyid($checkout_id);\r\n\r\n                        //get checkout start date\r\n                        $checkout_start_date = get_checkout_start($checkout_id);\r\n\r\n                        //get checkout start timestamp\r\n                        $checkout_start_timestamp = strtotime($checkout_start_date);\r\n\r\n                        //get amount of days left for checkout\r\n                        $amount_of_chekout_days_left = ($checkout_start_timestamp + (MAX_CHECKOUT_DAYS * 24 * 60 * 60) - time()) / (24 * 60 * 60);\r\n\r\n                        //if the amount of days left is less than 0, the user has exceeded the checkout limit\r\n                        if ($amount_of_chekout_days_left < 0) {\r\n\r\n                            $exceeded_amount_of_days = abs($amount_of_chekout_days_left);\r\n                            $fine = $exceeded_amount_of_days * FINE_PER_DAY;\r\n                            echo '<div class=\"description\">\r\n                            <span>You have exceeded max day limit!</span>\r\n                            <span>Copy ID : '. $checkouted_copyid . '</span>\r\n                            <span>Days Exceeded : '. $exceeded_amount_of_days . '</span>\r\n                            <span>Fine : '. $fine . '</span>\r\n                        </div>';\r\n\r\n\r\n                        }else{\r\n\r\n                            echo '<div class=\"description\">\r\n                        <span>You have already checked out a copy of this book!</span>\r\n                        <span>Copy ID : '. $checkouted_copyid . '</span>\r\n                        <span>Checkout Start Date : '. $checkout_start_date . '</span>\r\n                        <span>Days Left : '. $amount_of_chekout_days_left . '</span>\r\n                    </div>\r\n                        \r\n                        ';\r\n                        }\r\n\r\n\r\n                    } else {\r\n\r\n                                //check if user has already reserved the book\r\n                                if (is_user_reserved_book($_SESSION['uuid'], $bookid)) {\r\n                                    $time_left_string = get_reservation_time_left_string(get_reservation_id($bookid, $_SESSION['uuid']));\r\n                                    echo '<div class=\"description\">\r\n                                    <span>You have already reserved this book!</span>\r\n                                    <span>Visit our library to borrow your copy of the book!</span>\r\n                                    <span>Time Left : '. $time_left_string . '</span>\r\n                                    </div>\r\n                                    ';\r\n                                } else {\r\n\r\n                                    if (has_user_exceeded_reservation_limit($_SESSION['uuid'])) {\r\n                                        echo '<div class=\"description\">\r\n                                        <span>You have exceeded the reservation limit!</span>\r\n                                        </div>\r\n                                    ';\r\n                                    }else {\r\n                                        //check if book has available copies for current reservation\r\n                                        $total_amount_of_copies = get_amount_of_copies($bookid);\r\n                                        $pr_amount_of_copies = get_amount_of_pr_copies($bookid);\r\n                                        $non_pr_amount_of_copies = $total_amount_of_copies - $pr_amount_of_copies;\r\n                                        $reservations = get_amount_of_reservations_of_book($bookid);\r\n\r\n                                        if ($non_pr_amount_of_copies <= $reservations) {\r\n                                            echo '<div class=\"description\">\r\n                                        <span>There are no available copies for reservation!</span>';\r\n                                        } else {\r\n                                            echo '<div class=\"description\">\r\n                                        <span>This book is available for reservations!</span>\r\n                                        <form action=\"\" method=\"post\" id=\"res\">\r\n                                        <div class=\"book-button\">\r\n                                        <input type=\"submit\" id=\"button\" value=\"Reserve\" name=\"Reserve\" class=\"login_submit\">\r\n                                        </div>\r\n                                        </form>\r\n                                        ';\r\n                                        }\r\n                                    }\r\n                                }\r\n                    }\r\n                }\r\n\r\n                ?>\r\n\r\n\r\n                <?php\r\n                if(isset($_POST['Reserve'])){\r\n\r\n                    $bookid = $_GET['id'];\r\n                    $uuid = $_SESSION['uuid'];\r\n\r\n                    if(can_user_reserve_book($uuid, $bookid)){\r\n                        add_reservation($bookid, $uuid);\r\n                        //Send to the dashboard\r\n                        header('Location: /dashboard.php');\r\n                        exit;\r\n\r\n                    }else{\r\n\r\n                        echo get_reason_why_user_cannot_reserve_book($uuid, $bookid);\r\n\r\n                    }\r\n\r\n                }\r\n                ?>\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n</body>\r\n</html>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/book.php b/book.php
--- a/book.php	
+++ b/book.php	
@@ -180,6 +180,7 @@
 
                     if(can_user_reserve_book($uuid, $bookid)){
                         add_reservation($bookid, $uuid);
+                        add_reservation_report($bookid, $uuid);
                         //Send to the dashboard
                         header('Location: /dashboard.php');
                         exit;
